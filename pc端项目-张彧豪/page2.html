<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/page2.css">
</head>

<body>

    <div class="wrapper">
        <aside class="aside">
            <div class="yellow">

            </div>
            <div class="top normal">

            </div>
            <ul class="middle">
                <li>
                    <i class="user"></i>
                    <em>尚品会员</em>
                </li>
                <li>
                    <i class="car"></i>
                    <em>购物车</em>
                </li>
                <li>
                    <i class="clock"></i>
                    <em>我的关注</em>
                </li>
                <li>
                    <i class="talk"></i>
                    <em>我的足迹</em>
                </li>
                <li>
                    <i class="message"></i>
                    <em>我的消息</em>
                </li>
                <li>
                    <i class="topArrow"></i>
                    <em>我的消息</em>
                </li>
            </ul>
            <div class="bottom">

            </div>
        </aside>
        <div class="header">
            <div class="top">
                <div class="container">
                    <div class="container-left">
                        <p>尚品汇欢迎您!</p>
                        <span>请</span>
                        <a href="#">登录</a>
                        <a href="#">免费注册</a>
                    </div>
                    <nav>
                        <a href="#">我的订单</a>
                        <a href="#">我的购物车</a>
                        <a href="#">我的尚品汇</a>
                        <a href="#">尚品汇会员</a>
                        <a href="#">企业采购</a>
                        <a href="#">关注尚品汇</a>
                        <a href="#">企业招商</a>
                        <a href="#">商家后台</a>
                    </nav>
                </div>

            </div>
            <div class="bottom">
                <h1>
                    <img src="img/images/Logo.png" alt="尚品汇">
                </h1>
                <div class="bottom-right">
                    <form action="#">
                        <input type="text">
                        <button>搜索</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="typeWrapper">
            <div class="type">
                <h2>全部商品分类</h2>
                <div class="typeList">
                    <a href="#">服装城</a>
                    <a href="#">美妆馆</a>
                    <a href="#">尚品汇超市</a>
                    <a href="#">全球购</a>
                    <a href="#">闪购</a>
                    <a href="#">团购</a>
                    <a href="#">有趣</a>
                    <a href="#">秒杀</a>
                </div>
            </div>
        </div>
        <main>
            <h3>全部商品</h3>
            <div class="all">
                <span>全部</span>
                <span>商品</span>
                <span>单价(元)</span>
                <span>数量</span>
                <span>小计(元)</span>
                <span>操作</span>
            </div>
            <ul class="goods">
            </ul>
            <div class="bottom">
                <div class="left">
                    <input type="checkbox">
                    <span>全选</span>
                    <a href="#" class="cancelall">删除选中的商品</a>
                    <span>移到我的关注</span>
                    <span>清除下柜商品</span>
                </div>
                <div class="right">
                    <span>已经选择 </span>
                    <em>0</em>
                    <span>件商品</span>
                    <span>总价(不含运费)：</span>
                    <span>￥</span>
                    <span class="endmoney">0</span>
                    <a href="#">结算</a>
                </div>
            </div>
        </main>
        <div class="footerWrapper">
            <div class="footer">
                <ul class="information">
                    <li>
                        <h4>购物指南</h4>
                        <p>购物流程</p>
                        <p>会员介绍</p>
                        <p>生活旅行/团购</p>
                        <p>常见问题</p>
                        <p>购物指南</p>
                    </li>
                    <li>
                        <h4>配送方式</h4>
                        <p>上门自提</p>
                        <p>211限时达</p>
                        <p>配送服务查询</p>
                        <p>配送费收取标准</p>
                        <p>海外配送</p>
                    </li>
                    <li>
                        <h4>支付方式</h4>
                        <p>货到付款</p>
                        <p>在线支付</p>
                        <p>分期付款</p>
                        <p>邮局汇款</p>
                        <p>公司转账</p>
                    </li>
                    <li>
                        <h4>售后服务</h4>
                        <p>售后政策</p>
                        <p>价格保护</p>
                        <p>退款说明</p>
                        <p>返修/退换货</p>
                        <p>取消订单</p>
                    </li>
                    <li>
                        <h4>特色服务</h4>
                        <p>夺宝岛</p>
                        <p>DIY装机</p>
                        <p>延保服务</p>
                        <p>尚品汇E卡</p>
                        <p>尚品汇通信</p>
                    </li>
                    <li>
                        <h4>帮助中心</h4>
                        <img src="img/images/wx_cz.jpg" alt="">
                    </li>
                </ul>
                <ul class="aboutUs">
                    <li>关于我们</li>
                    <li>关于我们</li>
                    <li>关于我们</li>
                    <li>关于我们</li>
                    <li>关于我们</li>
                    <li>关于我们</li>
                    <li>关于我们</li>
                    <li>关于我们</li>
                    <li>关于我们</li>
                    <li>关于我们</li>
                </ul>
                <p>地址：北京市昌平区宏福科技园综合楼6层</p>
                <p>京ICP备19006430号</p>
            </div>
        </div>
    </div>
    <script src="cart.js"></script>
    <script>
        window.addEventListener("DOMContentLoaded", function () {
            asideShow();
            function asideShow() {
                var Xnode = document.querySelector(".wrapper > aside .top");
                var asideNode = document.querySelector(".wrapper > aside");
                var iNode = document.querySelectorAll(".wrapper > aside .middle li i");
                var eNode = document.querySelectorAll(".wrapper > aside .middle li em");
                var flag = true;
                Xnode.onclick = function () {
                    if (flag) {
                        asideNode.style.right = "0px";
                        Xnode.className = "top active"
                    } else {
                        asideNode.style.right = "-294px";
                        Xnode.className = "top normal"
                    }
                    flag = !flag;
                }
                iNode.forEach(function (value, index) {
                    value.onmouseenter = function () {
                        var ePosition = eNode[index].offsetLeft;
                        console.log(ePosition);
                        var timer = null;
                        this.style.backgroundColor = "#cc1122";
                        eNode[index].style.backgroundColor = "#cc1122";
                        eNode[index].style.left = "-67px";
                    }
                    value.onmouseleave = function () {
                        var ePosition = eNode[index].offsetLeft;
                        this.style.backgroundColor = "#7a6e6e";
                        eNode[index].style.backgroundColor = "#7a6e6e";
                        eNode[index].style.left = "35px";
                    }
                })
            }


            // 拿到page1传过来的数据
            getData();
            function getData() {
                var obj = localStorage.getItem("obj");
                if (obj) {
                    var newobj = JSON.parse(obj);
                    cartData.goods.unshift(newobj);
                }
            }

            //商品数据结构动态生成
            goodsStructure();
            function goodsStructure() {
                var data = cartData.goods;
                data.forEach(function (value) {
                    var str = `<li>
                                <input type="checkbox">
                                <img src=${value.goodImg} alt="">
                                <p>${value.goodTitle}</p>
                                <em>${value.goodTxt}</em>
                                <i>${value.goodPrice}</i>
                                <div class="count">
                                    <div class="minus">-</div>
                                    <input type="text" value=${value.goodNum}>
                                    <div class="plus">+</div>
                                </div>
                                <div class="price">
                                    ${value.goodPrice}
                                </div>
                                <div class="operate">
                                    <p class="cancel">删除</p>
                                    <p>移到收藏栏</p>
                                </div>
                            </li>`
                    var ulNode = document.querySelector(".wrapper > main .goods");
                    ulNode.innerHTML += str;
                })
            }

            //按钮的全选
            btn();
            function btn() {
                var allbtn = document.querySelector(".wrapper > main .bottom .left input");
                var tyebgn = document.querySelectorAll(".wrapper > main .goods li>input");
                allbtn.onchange = function () {
                    if (allbtn.checked) {
                        tyebgn.forEach(function (value) {
                            value.checked = true;

                        })
                        countMoney();
                    } else {
                        tyebgn.forEach(function (value) {

                            value.checked = false;
                            countMoney();
                        })

                    }

                }
                var flag = true;
                tyebgn.forEach(function (value) {
                    value.onchange = function () {
                        var againbgn = document.querySelectorAll(".wrapper > main .goods li>input");
                        againbgn.forEach(function (value) {
                            if (!value.checked) {
                                flag = false;
                            }
                        })
                        if (flag) {
                            allbtn.checked = true;
                        } else {
                            allbtn.checked = false;
                        }
                        flag = true;
                        countMoney();
                    }
                })
            }

            addCancel();
            function addCancel() {
                var plus = document.querySelectorAll(".wrapper > main .goods li .count .plus");
                var minus = document.querySelectorAll(".wrapper > main .goods li .count .minus");
                var num = document.querySelectorAll(".wrapper > main .goods li .count > input");
                var money = document.querySelectorAll(".wrapper > main .goods li .price");
                var onepiece = document.querySelectorAll(".wrapper > main .goods li i")
                for (var i = 0; i < plus.length; i++) {
                    plus[i].index = i;
                    minus[i].index = i;
                    plus[i].onclick = function () {
                        var newnum = parseInt(num[this.index].value);
                        newnum += 1;
                        num[this.index].value = newnum;
                        money[this.index].innerText = (newnum * onepiece[this.index].innerText).toFixed(2);
                        countMoney();

                    }
                    minus[i].onclick = function () {
                        if (num[this.index].value > 1) {
                            var newnum = parseInt(num[this.index].value);
                            newnum -= 1;
                            num[this.index].value = newnum;
                            money[this.index].innerText = (newnum * onepiece[this.index].innerText).toFixed(2);
                            countMoney();
                        }
                    }
                }
            }

            //删除行
            deleterow();
            function deleterow() {
                var cancel = document.querySelectorAll(".wrapper > main .goods li .operate .cancel");
                var goods = document.querySelector(".wrapper > main .goods");
                //单行删除
                cancel.forEach(function (value, index) {
                    value.onclick = function () {
                        if (this.parentNode.parentNode.querySelector(".wrapper > main .goods li>input").checked) {
                            if (confirm("是否确定删除")) {
                                goods.removeChild(this.parentNode.parentNode);
                            }
                        }
                        countMoney();
                    }
                })
                //多行删除
                var allCancel = document.querySelector(".wrapper > main .bottom .left a ");
                allCancel.onclick = function () {
                    var tyebgn = document.querySelectorAll(".wrapper > main .goods li>input:checked");
                    tyebgn.forEach(function (value) {
                        goods.removeChild(value.parentNode);
                    })
                    countMoney();
                }
            }

            //计算总价钱和数量
            countMoney();
            function countMoney() {
                var tyebgn = document.querySelectorAll(".wrapper > main .goods li>input:checked");
                var allMoney = document.querySelector(".wrapper > main .bottom .right .endmoney");
                var start = 0;
                var num = document.querySelector(".wrapper > main .bottom .right em");
                var start1 = 0;
                if (tyebgn.length == 0) {
                    allMoney.innerHTML = 0
                } else {
                    tyebgn.forEach(function (value) {
                        start += parseFloat(value.parentNode.querySelector(".price").innerHTML);
                        allMoney.innerHTML = start;
                        start1 += parseFloat(value.parentNode.querySelector(".count input").value);
                        num.innerHTML = start1;
                    })
                }
            }
        })
    </script>
</body>

</html>